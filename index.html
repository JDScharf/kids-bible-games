<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bible Verse Memory Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Bubblegum+Sans&display=swap" rel="stylesheet">
    <style>
        :root {
            --midnight: #011627;
            --white: #fdfffc;
            --teal: #2ec4b6;
            --red: #e71d36;
            --orange: #ff9f1c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background: var(--midnight);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated background pattern */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(46, 196, 182, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 159, 28, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(231, 29, 54, 0.05) 0%, transparent 50%);
            animation: bgMove 20s ease-in-out infinite;
        }

        @keyframes bgMove {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }

        .container {
            background: var(--white);
            border-radius: 40px;
            padding: 50px;
            max-width: 1400px;
            width: 100%;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 1;
        }

        /* Selection Screen Styles */
        .selection-screen {
            display: block;
        }

        .selection-screen.hidden {
            display: none;
        }

        .game-screen {
            display: none;
        }

        .game-screen.active {
            display: block;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .title {
            font-family: 'Bubblegum Sans', cursive;
            font-size: 3.5em;
            color: var(--teal);
            margin-bottom: 10px;
        }

        @keyframes titleBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .subtitle {
            font-size: 1.8em;
            color: var(--teal);
            font-weight: 600;
            margin-bottom: 20px;
        }

        /* Verse Selection */
        .verse-selection {
            background: linear-gradient(135deg, var(--orange), var(--red));
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .selection-label {
            color: var(--white);
            font-size: 1.6em;
            margin-bottom: 20px;
            font-weight: 700;
            display: block;
            text-align: center;
        }

        .verse-input-group {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        /* Book input autocomplete container */
        .book-input-container {
            position: relative;
        }

        .verse-input {
            padding: 20px;
            font-size: 1.3em;
            border: 3px solid var(--white);
            border-radius: 15px;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            width: 100%;
        }

        .verse-input:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(253, 255, 252, 0.3);
        }

        /* Dropdown for book suggestions */
        .book-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--white);
            border: 3px solid var(--teal);
            border-radius: 15px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            margin-top: 5px;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .book-dropdown.show {
            display: block;
        }

        .book-option {
            padding: 15px 20px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: 600;
            color: var(--midnight);
            transition: all 0.2s;
            border-bottom: 2px solid rgba(46, 196, 182, 0.2);
        }

        .book-option:last-child {
            border-bottom: none;
        }

        .book-option:hover,
        .book-option.selected {
            background: var(--teal);
            color: var(--white);
        }

        /* Popular Verses */
        .popular-verses {
            background: var(--midnight);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .popular-title {
            color: var(--white);
            font-size: 1.4em;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 700;
        }

        .verse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .verse-option {
            background: var(--teal);
            color: var(--white);
            padding: 15px 20px;
            border-radius: 15px;
            border: none;
            font-size: 1.3em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Fredoka', sans-serif;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .verse-option:hover {
            background: var(--orange);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .verse-option:active {
            transform: translateY(0);
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 2em;
            color: var(--teal);
        }

        .spinner {
            border: 5px solid var(--white);
            border-top: 5px solid var(--teal);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error Message */
        .error-message {
            background: var(--red);
            color: var(--white);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-size: 1.3em;
            font-weight: 600;
            text-align: center;
            display: none;
        }

        .error-message.show {
            display: block;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

                        .instructions {
            background: linear-gradient(135deg, var(--teal), var(--orange));
            border: 4px solid var(--midnight);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            font-size: 1.6em;
            text-align: center;
            color: var(--white);
            font-weight: 600;
        }

        /* Game Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--teal), var(--orange));
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            color: var(--white);
        }

        .stat-label {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            font-family: 'Bubblegum Sans', cursive;
        }

        /* Verse Display */
        .verse-display {
            background: var(--midnight);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            min-height: 300px;
        }

        .verse-reference {
            color: var(--orange);
            font-size: 1.5em;
            font-weight: 700;
            text-align: center;
            margin-bottom: 30px;
        }

        .verse-text {
            color: var(--white);
            font-size: 1.8em;
            line-height: 1.8;
            text-align: center;
            font-weight: 600;
        }

        .word {
            display: inline-block;
            margin: 5px;
            padding: 10px 15px;
            border-radius: 12px;
            transition: all 0.3s;
        }

        .word.visible {
            color: var(--white);
            background: transparent;
        }

        .word.hidden {
            background: var(--teal);
            color: transparent;
            cursor: pointer;
            user-select: none;
        }

        .word.hidden:hover {
            background: var(--orange);
            transform: scale(1.1);
        }

        .word.revealed {
            background: var(--red);
            color: var(--white);
            animation: revealPop 0.5s;
        }

        @keyframes revealPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Game Controls */
        .game-controls {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .btn {
            padding: 20px 40px;
            font-size: 1.5em;
            font-weight: 700;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Fredoka', sans-serif;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: var(--teal);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--orange);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .btn-secondary {
            background: var(--orange);
            color: var(--white);
        }

        .btn-secondary:hover {
            background: var(--red);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Level Complete Modal */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(1, 22, 39, 0.9);
            display: none;
            z-index: 1000;
        }

        .overlay.show {
            display: block;
        }

        .level-complete {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--white);
            border-radius: 40px;
            padding: 60px;
            text-align: center;
            z-index: 1001;
            transition: transform 0.3s;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
        }

        .level-complete.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .level-complete h2 {
            font-family: 'Bubblegum Sans', cursive;
            font-size: 3em;
            color: var(--teal);
            margin-bottom: 20px;
        }

        .level-complete p {
            font-size: 1.8em;
            color: var(--midnight);
            margin-bottom: 30px;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .container {
                padding: 30px;
            }

            .title {
                font-size: 2.5em;
            }

            .verse-input-group {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .game-controls {
                flex-direction: column;
            }
        }

               /* Rickroll Modal Styles */
        .rickroll-modal {
            max-width: 700px;
        }

        .rickroll-modal iframe {
            width: 100%;
            height: 315px;
            border-radius: 20px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .rickroll-modal iframe {
                height: 200px;
            }
        }

/* Fireworks Animation */
.fireworks {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9999;
}

.firework {
    position: absolute;
    width: 5px;
    height: 5px;
    border-radius: 50%;
    animation: explode 1s ease-out forwards;
}

@keyframes explode {
    0% {
        transform: translate(0, 0) scale(1);
        opacity: 1;
    }
    100% {
        transform: translate(var(--tx), var(--ty)) scale(0);
        opacity: 0;
    }
}

/* Walking Animal */
.walking-animal {
    position: fixed;
    bottom: 15px;
    left: -150px;
    width: 300px;
    height: 300px;
    animation: walkAcross 8s linear forwards;
    z-index: 9998;
}

@keyframes walkAcross {
    0% {
        left: -150px;
        transform: scaleX(1);
    }
    100% {
        left: calc(100% + 150px);
        transform: scaleX(1);
    }
}
    </style>
</head>
<body>
    <div class="container">
        <!-- Selection Screen -->
        <div id="selectionScreen" class="selection-screen">
            <div class="header">
                <h1 class="title">üìñ Kid Life - Bible Memory Game</h1>
                <p class="subtitle">Choose your verse and start memorizing!</p>
            </div>

            <div id="errorMessage" class="error-message"></div>
            <div id="loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Loading verse...</p>
            </div>

            <div class="verse-selection">
                <span class="selection-label">üîç Search for a Verse</span>
                <div class="verse-input-group">
                    <div class="book-input-container">
                        <input 
                            type="text" 
                            id="bookInput" 
                            class="verse-input" 
                            placeholder="Book (e.g., John)" 
                            autocomplete="off"
                        >
                        <div id="bookDropdown" class="book-dropdown"></div>
                    </div>
                    <input type="number" id="chapterInput" class="verse-input" placeholder="Chapter" min="1">
                    <input type="number" id="verseInput" class="verse-input" placeholder="Verse" min="1">
                </div>
                <button id="loadVerseBtn" class="btn btn-primary" style="width: 100%; margin-top: 10px;">
                    üéÆ Load This Verse & Start Game
                </button>
            </div>

            <div class="popular-verses">
                <h3 class="popular-title">‚≠ê Or Choose a Popular Memory Verse:</h3>
                 <div class="verse-grid">
                    <button class="verse-option" data-ref="JHN.3.16">John 3:16</button>
                    <button class="verse-option" data-ref="JHN.13.34">John 13:34</button>
                    <button class="verse-option" data-ref="PHP.4.13">Philippians 4:13</button>
                    <button class="verse-option" data-ref="JER.29.11">Jeremiah 29:11</button>
                    <button class="verse-option" data-ref="PSA.23.1">Psalm 23:1</button>
                    <button class="verse-option" data-ref="PRO.3.5-6">Proverbs 3:5-6</button>
                    <button class="verse-option" data-ref="ROM.8.28">Romans 8:28</button>
                    <button class="verse-option" data-ref="ISA.40.31">Isaiah 40:31</button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="game-screen">
            <div class="header">
                <h1 class="title">üìñ Kid Life - Bible Memory Game</h1>
            </div>

            <div class="instructions">
                Tap the blue boxes to see the words. Try to say the whole verse without clicking! üåü
            </div>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-label">Level</div>
                    <div class="stat-value" id="level">1</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Score</div>
                    <div class="stat-value" id="score">100</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Words Left</div>
                    <div class="stat-value" id="wordsLeft">0</div>
                </div>
            </div>

            <div class="verse-display">
                <div id="verseReference" class="verse-reference"></div>
                <div id="verseWords" class="verse-text"></div>
            </div>

            <div class="game-controls">
                <button id="nextLevel" class="btn btn-primary">Next Level ‚û°Ô∏è</button>
                <button id="tryAgain" class="btn btn-secondary">Try Again üîÑ</button>
                <button id="changeVerse" class="btn btn-secondary">Change Verse üìñ</button>
            </div>
        </div>

        <!-- Level Complete Modal -->
        <div id="overlay" class="overlay"></div>
        <div id="levelComplete" class="level-complete">
            <h2>üéâ Level Complete! üéâ</h2>
            <p>You completed Level <span id="completedLevel">1</span>!</p>
            <p>Final Score: <span id="finalScore">100</span></p>
            <button id="continueBtn" class="btn btn-primary">Continue to Next Level</button>
        </div>
    </div>

    
    <!-- Rickroll Modal -->
    <div class="overlay" id="rickrollOverlay"></div>
    <div class="level-complete rickroll-modal" id="rickrollModal">
        <h2>üò± Oh No! You're Out of Points! üò±</h2>
        <iframe 
            id="rickrollVideo"
            width="560" 
            height="315" 
            src="" 
            title="YouTube video player" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
            referrerpolicy="strict-origin-when-cross-origin" 
            allowfullscreen>
        </iframe>
        <button class="btn btn-primary" id="closeRickroll">
            I've Learned My Lesson üòÖ
        </button>
    </div>

    <!-- Fireworks Container -->
<div id="fireworksContainer" class="fireworks"></div>

<!-- Walking Animal -->
<div id="walkingAnimal" class="walking-animal" style="display: none;"></div>

    <script>
        // Replace with your actual API.Bible key
        const DEFAULT_BIBLE_ID = '78a9f6124f344018-01'; // NIV   
        // 06125adad2d5898a-01 = World English Bible
        const API_KEY = 'Fo3jWbgd_jopCVaJ5SZ1l'; // Replace with your API key from scripture.api.bible

        // Game state
        let verseText = '';
        let words = [];
        let currentLevel = 1;
        let currentScore = 100;
        let hiddenWords = [];
        let revealedWords = new Set();
        let currentVerseReference = '';

        // Level configurations
        const levelConfigs = [
            { hiddenIndices: [], description: "Learn the verse!" },
            { hiddenIndices: [0, 4, 8, 12, 16, 20], description: "6 words hidden" },
            { hiddenIndices: [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22], description: "12 words hidden" },
            { hiddenIndices: [0, 1, 2, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 20,23,26], description: "Almost all hidden!" },
            { hiddenIndices: Array.from({length: 50}, (_, i) => i), description: "All words hidden!" }
        ];

        // Bible books list for autocomplete
        const bibleBooks = [
            'Genesis', 'Exodus', 'Leviticus', 'Numbers', 'Deuteronomy',
            'Joshua', 'Judges', 'Ruth', '1 Samuel', '2 Samuel',
            '1 Kings', '2 Kings', '1 Chronicles', '2 Chronicles',
            'Ezra', 'Nehemiah', 'Esther', 'Job', 'Psalms', 'Proverbs',
            'Ecclesiastes', 'Song of Solomon', 'Isaiah', 'Jeremiah', 'Lamentations',
            'Ezekiel', 'Daniel', 'Hosea', 'Joel', 'Amos',
            'Obadiah', 'Jonah', 'Micah', 'Nahum', 'Habakkuk',
            'Zephaniah', 'Haggai', 'Zechariah', 'Malachi',
            'Matthew', 'Mark', 'Luke', 'John', 'Acts',
            'Romans', '1 Corinthians', '2 Corinthians', 'Galatians', 'Ephesians',
            'Philippians', 'Colossians', '1 Thessalonians', '2 Thessalonians',
            '1 Timothy', '2 Timothy', 'Titus', 'Philemon', 'Hebrews',
            'James', '1 Peter', '2 Peter', '1 John', '2 John',
            '3 John', 'Jude', 'Revelation'
        ];

        // Book abbreviations mapping
        const bookAbbreviations = {
            'genesis': 'GEN', 'gen': 'GEN',
            'exodus': 'EXO', 'exo': 'EXO', 'exod': 'EXO',
            'leviticus': 'LEV', 'lev': 'LEV',
            'numbers': 'NUM', 'num': 'NUM',
            'deuteronomy': 'DEU', 'deut': 'DEU', 'deu': 'DEU',
            'joshua': 'JOS', 'josh': 'JOS', 'jos': 'JOS',
            'judges': 'JDG', 'judg': 'JDG', 'jdg': 'JDG',
            'ruth': 'RUT', 'rut': 'RUT',
            '1 samuel': '1SA', '1samuel': '1SA', '1 sam': '1SA', '1sam': '1SA',
            '2 samuel': '2SA', '2samuel': '2SA', '2 sam': '2SA', '2sam': '2SA',
            '1 kings': '1KI', '1kings': '1KI', '1 ki': '1KI', '1ki': '1KI',
            '2 kings': '2KI', '2kings': '2KI', '2 ki': '2KI', '2ki': '2KI',
            '1 chronicles': '1CH', '1chronicles': '1CH', '1 chron': '1CH', '1chron': '1CH',
            '2 chronicles': '2CH', '2chronicles': '2CH', '2 chron': '2CH', '2chron': '2CH',
            'ezra': 'EZR', 'ezr': 'EZR',
            'nehemiah': 'NEH', 'neh': 'NEH',
            'esther': 'EST', 'est': 'EST',
            'job': 'JOB',
            'psalms': 'PSA', 'psalm': 'PSA', 'psa': 'PSA', 'ps': 'PSA',
            'proverbs': 'PRO', 'prov': 'PRO', 'pro': 'PRO',
            'ecclesiastes': 'ECC', 'eccl': 'ECC', 'ecc': 'ECC',
            'song of solomon': 'SNG', 'song': 'SNG', 'sos': 'SNG',
            'isaiah': 'ISA', 'isa': 'ISA',
            'jeremiah': 'JER', 'jer': 'JER',
            'lamentations': 'LAM', 'lam': 'LAM',
            'ezekiel': 'EZK', 'ezek': 'EZK', 'ezk': 'EZK',
            'daniel': 'DAN', 'dan': 'DAN',
            'hosea': 'HOS', 'hos': 'HOS',
            'joel': 'JOL', 'joel': 'JOL',
            'amos': 'AMO', 'amo': 'AMO',
            'obadiah': 'OBA', 'obad': 'OBA', 'oba': 'OBA',
            'jonah': 'JON', 'jon': 'JON',
            'micah': 'MIC', 'mic': 'MIC',
            'nahum': 'NAM', 'nah': 'NAM', 'nam': 'NAM',
            'habakkuk': 'HAB', 'hab': 'HAB',
            'zephaniah': 'ZEP', 'zeph': 'ZEP', 'zep': 'ZEP',
            'haggai': 'HAG', 'hag': 'HAG',
            'zechariah': 'ZEC', 'zech': 'ZEC', 'zec': 'ZEC',
            'malachi': 'MAL', 'mal': 'MAL',
            'matthew': 'MAT', 'matt': 'MAT', 'mat': 'MAT', 'mt': 'MAT',
            'mark': 'MRK', 'mrk': 'MRk', 'mk': 'MRK',
            'luke': 'LUK', 'luk': 'LUK', 'lk': 'LUK',
            'john': 'JHN', 'jhn': 'JHN', 'jn': 'JHN',
            'acts': 'ACT', 'act': 'ACT',
            'romans': 'ROM', 'rom': 'ROM',
            '1 corinthians': '1CO', '1corinthians': '1CO', '1 cor': '1CO', '1cor': '1CO',
            '2 corinthians': '2CO', '2corinthians': '2CO', '2 cor': '2CO', '2cor': '2CO',
            'galatians': 'GAL', 'gal': 'GAL',
            'ephesians': 'EPH', 'eph': 'EPH',
            'philippians': 'PHP', 'phil': 'PHP', 'php': 'PHP',
            'colossians': 'COL', 'col': 'COL',
            '1 thessalonians': '1TH', '1thessalonians': '1TH', '1 thess': '1TH', '1thess': '1TH',
            '2 thessalonians': '2TH', '2thessalonians': '2TH', '2 thess': '2TH', '2thess': '2TH',
            '1 timothy': '1TI', '1timothy': '1TI', '1 tim': '1TI', '1tim': '1TI',
            '2 timothy': '2TI', '2timothy': '2TI', '2 tim': '2TI', '2tim': '2TI',
            'titus': 'TIT', 'tit': 'TIT',
            'philemon': 'PHM', 'philem': 'PHM', 'phm': 'PHM',
            'hebrews': 'HEB', 'heb': 'HEB',
            'james': 'JAS', 'jas': 'JAS',
            '1 peter': '1PE', '1peter': '1PE', '1 pet': '1PE', '1pet': '1PE',
            '2 peter': '2PE', '2peter': '2PE', '2 pet': '2PE', '2pet': '2PE',
            '1 john': '1JN', '1john': '1JN',
            '2 john': '2JN', '2john': '2JN',
            '3 john': '3JN', '3john': '3JN',
            'jude': 'JUD', 'jud': 'JUD',
            'revelation': 'REV', 'rev': 'REV'
        };

        // Autocomplete variables
        let selectedBookIndex = -1;
        let filteredBooks = [];

        // Initialize event listeners
        const bookInput = document.getElementById('bookInput');
        const bookDropdown = document.getElementById('bookDropdown');

        bookInput.addEventListener('input', handleBookInput);
        bookInput.addEventListener('keydown', handleBookKeydown);
        bookInput.addEventListener('blur', () => {
            // Delay hiding to allow click on dropdown
            setTimeout(() => {
                bookDropdown.classList.remove('show');
            }, 200);
        });

        document.getElementById('loadVerseBtn').addEventListener('click', loadCustomVerse);
        document.querySelectorAll('.verse-option').forEach(btn => {
            btn.addEventListener('click', (e) => loadVerseByRef(e.target.dataset.ref));
        });
        document.getElementById('nextLevel').addEventListener('click', handleNextLevel);
        document.getElementById('tryAgain').addEventListener('click', tryAgain);
        document.getElementById('changeVerse').addEventListener('click', changeVerse);
        document.getElementById('continueBtn').addEventListener('click', continueToNextLevel);
        document.getElementById('closeRickroll').addEventListener('click', closeRickroll);

        // Autocomplete functions
        function handleBookInput(e) {
            const searchTerm = e.target.value.toLowerCase().trim();
            
            if (searchTerm === '') {
                bookDropdown.classList.remove('show');
                return;
            }

            // Filter books that start with or contain the search term
            filteredBooks = bibleBooks.filter(book => 
                book.toLowerCase().includes(searchTerm)
            );

            if (filteredBooks.length > 0) {
                displayBookDropdown(filteredBooks);
                selectedBookIndex = -1;
            } else {
                bookDropdown.classList.remove('show');
            }
        }

        function displayBookDropdown(books) {
            bookDropdown.innerHTML = '';
            
            books.forEach((book, index) => {
                const option = document.createElement('div');
                option.className = 'book-option';
                option.textContent = book;
                option.addEventListener('click', () => selectBook(book));
                bookDropdown.appendChild(option);
            });

            bookDropdown.classList.add('show');
        }

        function handleBookKeydown(e) {
            const options = bookDropdown.querySelectorAll('.book-option');
            
            if (!bookDropdown.classList.contains('show') || options.length === 0) {
                return;
            }

            switch(e.key) {
                case 'ArrowDown':
                    e.preventDefault();
                    selectedBookIndex = Math.min(selectedBookIndex + 1, options.length - 1);
                    updateSelectedOption(options);
                    break;
                
                case 'ArrowUp':
                    e.preventDefault();
                    selectedBookIndex = Math.max(selectedBookIndex - 1, 0);
                    updateSelectedOption(options);
                    break;
                
                case 'Enter':
                    e.preventDefault();
                    if (selectedBookIndex >= 0 && selectedBookIndex < filteredBooks.length) {
                        selectBook(filteredBooks[selectedBookIndex]);
                    }
                    break;
                
                case 'Escape':
                    bookDropdown.classList.remove('show');
                    break;
            }
        }

        function updateSelectedOption(options) {
            options.forEach((option, index) => {
                if (index === selectedBookIndex) {
                    option.classList.add('selected');
                    option.scrollIntoView({ block: 'nearest' });
                } else {
                    option.classList.remove('selected');
                }
            });
        }

        function selectBook(bookName) {
            bookInput.value = bookName;
            bookDropdown.classList.remove('show');
            document.getElementById('chapterInput').focus();
        }

        // API Functions
        async function fetchVerse(verseId) {
            if (!API_KEY || API_KEY === 'API_KEY') {
                showError('API key not configured. Please add your API key to the code.');
                return null;
            }

            showLoading(true);

            try {
                const response = await fetch(
                    `https://rest.api.bible/v1/bibles/${DEFAULT_BIBLE_ID}/verses/${verseId}?content-type=html&include-notes=false&include-titles=false&include-chapter-numbers=false&include-verse-numbers=false&include-verse-spans=false&use-org-id=false`,
                    {
                        headers: {
                            'api-key': API_KEY
                        }
                    }
                );

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                showLoading(false);
                return data.data;
            } catch (error) {
                showLoading(false);
                showError(`Error loading verse: ${error.message}. Make sure your API key is correct.`);
                return null;
            }
        }

        function convertToVerseId(book, chapter, verse) {
            const bookKey = book.toLowerCase().trim();
            const bookCode = bookAbbreviations[bookKey];
            
            if (!bookCode) {
                showError(`Book "${book}" not recognized. Try using the full name like "John" or "Genesis"`);
                return null;
            }

            return `${bookCode}.${chapter}.${verse}`;
        }

        async function loadCustomVerse() {
            const book = document.getElementById('bookInput').value.trim();
            const chapter = document.getElementById('chapterInput').value.trim();
            const verse = document.getElementById('verseInput').value.trim();

            if (!book || !chapter || !verse) {
                showError('Please enter a book, chapter, and verse number');
                return;
            }

            const verseId = convertToVerseId(book, chapter, verse);
            if (!verseId) return;

            await loadVerseByRef(verseId);
        }

        async function loadVerseByRef(verseRef) {
            const verseData = await fetchVerse(verseRef);
            if (!verseData) return;

            // Extract text and clean it
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = verseData.content;
            verseText = tempDiv.textContent.trim();
            
            // Remove verse numbers and extra whitespace
            verseText = verseText.replace(/\[\d+\]/g, '').replace(/\s+/g, ' ').trim();
            
            currentVerseReference = verseData.reference;
            words = verseText.split(' ');

            // Start game
            startGame();
        }

        function startGame() {
            document.getElementById('selectionScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.add('active');
            document.getElementById('verseReference').textContent = currentVerseReference;
            
            currentLevel = 1;
            currentScore = 100;
            initGame();
        }

        function changeVerse() {
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('selectionScreen').classList.remove('hidden');
            
            // Reset inputs
            document.getElementById('bookInput').value = '';
            document.getElementById('chapterInput').value = '';
            document.getElementById('verseInput').value = '';
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
            setTimeout(() => {
                errorDiv.classList.remove('show');
            }, 5000);
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // Game Functions
        function initGame() {
            renderVerse();
            updateStats();
        }

        function renderVerse() {
            const container = document.getElementById('verseWords');
            container.innerHTML = '';
            
            const config = levelConfigs[Math.min(currentLevel - 1, levelConfigs.length - 1)];
            hiddenWords = config.hiddenIndices.slice(0, words.length);
            revealedWords.clear();
            
            words.forEach((word, index) => {
                const wordSpan = document.createElement('span');
                wordSpan.textContent = word;
                wordSpan.classList.add('word');
                
                if (hiddenWords.includes(index)) {
                    wordSpan.classList.add('hidden');
                    wordSpan.dataset.index = index;
                    wordSpan.addEventListener('click', () => revealWord(wordSpan, index));
                } else {
                    wordSpan.classList.add('visible');
                }
                
                container.appendChild(wordSpan);
            });
            
            updateWordsLeft();

// Update button text based on level
const nextLevelBtn = document.getElementById('nextLevel');
if (currentLevel >= levelConfigs.length) {
    nextLevelBtn.textContent = 'Verse Memorized Correctly! üéâ';
} else {
    nextLevelBtn.textContent = 'Next Level ‚û°Ô∏è';
}

        }

        function revealWord(wordSpan, index) {
            if (revealedWords.has(index)) return;
            
            wordSpan.classList.remove('hidden');
            wordSpan.classList.add('revealed');
            revealedWords.add(index);
            
            currentScore = Math.max(0, currentScore - 10);

           // Check if score hit 0 and trigger rickroll
            if (currentScore === 0) {
                showRickroll();
            }

            updateStats();
            
            wordSpan.style.animation = 'none';
            setTimeout(() => {
                wordSpan.style.animation = '';
            }, 10);
        }

        function updateStats() {
            document.getElementById('level').textContent = currentLevel;
            document.getElementById('score').textContent = currentScore;
            updateWordsLeft();
        }

        function updateWordsLeft() {
            const wordsLeft = hiddenWords.length - revealedWords.size;
            document.getElementById('wordsLeft').textContent = wordsLeft;
        }

        function showLevelComplete() {
            document.getElementById('completedLevel').textContent = currentLevel;
            document.getElementById('finalScore').textContent = currentScore;
            document.getElementById('overlay').classList.add('show');
            document.getElementById('levelComplete').classList.add('show');
        }

        function hideLevelComplete() {
            document.getElementById('overlay').classList.remove('show');
            document.getElementById('levelComplete').classList.remove('show');
        }

function handleNextLevel() {
    if (currentLevel < levelConfigs.length) {
        showLevelComplete();
    } else {
        // Last level completed!
        showFinalCelebration();
    }
}

        function continueToNextLevel() {
            hideLevelComplete();
            currentLevel++;
            currentScore = 100;
            renderVerse();
            updateStats();
            
            if (currentLevel > levelConfigs.length) {
                alert('üéä Amazing! You finished the entire game! üéä');
                currentLevel = 1;
                currentScore = 100;
                renderVerse();
                updateStats();
            }
        }

        function tryAgain() {
            currentScore = 100;
            revealedWords.clear();
            renderVerse();
            updateStats();
        }


        // Rickroll functions
        function showRickroll() {
            const iframe = document.getElementById('rickrollVideo');
            iframe.src = 'https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1';
            document.getElementById('rickrollOverlay').classList.add('show');
            document.getElementById('rickrollModal').classList.add('show');
        }

        function closeRickroll() {
            const iframe = document.getElementById('rickrollVideo');
            iframe.src = ''; // Stop the video
            document.getElementById('rickrollOverlay').classList.remove('show');
            document.getElementById('rickrollModal').classList.remove('show');
            tryAgain(); // Reset the game
        }

        function showFinalCelebration() {
    // Show the level complete modal first
    showLevelComplete();
    
    // Trigger fireworks
    setTimeout(() => {
        launchFireworks();
    }, 500);
    
    // Show walking animal
    setTimeout(() => {
        showWalkingAnimal();
    }, 1000);
}

function launchFireworks() {
    const container = document.getElementById('fireworksContainer');
    const colors = ['#2ec4b6', '#ff9f1c', '#e71d36', '#fdfffc'];
    
    // Launch 15 fireworks
    for (let i = 0; i < 15; i++) {
        setTimeout(() => {
            createFirework(container, colors);
        }, i * 300);
    }
}

function createFirework(container, colors) {
    const x = Math.random() * window.innerWidth;
    const y = Math.random() * (window.innerHeight * 0.5);
    
    // Create 20 particles per firework
    for (let i = 0; i < 20; i++) {
        const particle = document.createElement('div');
        particle.className = 'firework';
        particle.style.left = x + 'px';
        particle.style.top = y + 'px';
        particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        
        const angle = (Math.PI * 2 * i) / 20;
        const velocity = 50 + Math.random() * 100;
        const tx = Math.cos(angle) * velocity;
        const ty = Math.sin(angle) * velocity;
        
        particle.style.setProperty('--tx', tx + 'px');
        particle.style.setProperty('--ty', ty + 'px');
        
        container.appendChild(particle);
        
        // Remove particle after animation
        setTimeout(() => {
            particle.remove();
        }, 1000);
    }
}

function showWalkingAnimal() {
    const animalGifs = [
        'gifs/bird.gif',
        'gifs/capybara.gif',
                'gifs/dog-summer.gif',
        'gifs/dog-walk.gif',
                'gifs/fancy-cat.gif',
        'gifs/groundhog.gif',
                'gifs/video-dog.gif'
        // etc.
    ];
    
    const animal = document.getElementById('walkingAnimal');
    const randomGif = animalGifs[Math.floor(Math.random() * animalGifs.length)];
    
    animal.innerHTML = `<img src="${randomGif}" style="width: 150px; height: 150px; object-fit: contain;">`;
    animal.style.display = 'block';
    
    setTimeout(() => {
        animal.style.display = 'none';
    }, 8000);
}
    </script>
</body>
</html>